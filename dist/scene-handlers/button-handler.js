"use strict";
/**
 * Button UI 创建处理器
 * 在场景脚本上下文中执行，可以直接访问 cc 对象
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createButtonWithTemplate = createButtonWithTemplate;
/**
 * 创建完整的 Button UI 组件
 * 包括 Background 子节点（Sprite + Widget）和 Label 子节点
 * @param name Button 节点名称
 * @param parentUuid 父节点 UUID
 * @param text Label 文本
 * @param width Button 宽度
 * @param height Button 高度
 * @param sprites 包含 4 个状态的图集 UUID: {normal, pressed, hover, disabled}
 * @param getCC 获取 Cocos 引擎实例的函数
 * @param markSceneDirty 标记场景为脏的函数
 */
function createButtonWithTemplate(name, parentUuid, text, width, height, sprites, getCC, markSceneDirty) {
    try {
        const { director, Node } = getCC();
        const scene = director.getScene();
        if (!scene) {
            return { success: false, error: 'No active scene' };
        }
        // 1. 创建主节点
        const buttonNode = new Node(name);
        const parent = parentUuid ? scene.getChildByUuid(parentUuid) : scene;
        if (parent) {
            parent.addChild(buttonNode);
        }
        else {
            scene.addChild(buttonNode);
        }
        // 设置主节点大小和锚点
        buttonNode.setContentSize(width, height);
        buttonNode.setAnchorPoint(0.5, 0.5);
        // 2. 添加 Button 组件
        const buttonComp = buttonNode.addComponent(cc.Button);
        // 3. 创建 Background 子节点
        const bgNode = new Node('Background');
        buttonNode.addChild(bgNode);
        bgNode.setContentSize(width, height);
        bgNode.setAnchorPoint(0.5, 0.5);
        // 4. 添加 Sprite 组件到 Background
        const spriteComp = bgNode.addComponent(cc.Sprite);
        spriteComp.type = cc.Sprite.Type.SLICED; // 九宫格模式
        spriteComp.sizeMode = cc.Sprite.SizeMode.CUSTOM; // 0 - CUSTOM 模式
        // 直接设置 SpriteFrame 的 UUID（更可靠的方法）
        const normalSpriteFrame = new cc.SpriteFrame();
        normalSpriteFrame._uuid = sprites.normal;
        spriteComp.spriteFrame = normalSpriteFrame;
        // 5. 添加 Widget 组件到 Background（完全对齐）
        const widgetComp = bgNode.addComponent(cc.Widget);
        // 重要：先设置对齐值，再启用对齐标志
        widgetComp.top = 0;
        widgetComp.bottom = 0;
        widgetComp.left = 0;
        widgetComp.right = 0;
        // 然后启用对齐
        widgetComp.isAlignTop = true;
        widgetComp.isAlignBottom = true;
        widgetComp.isAlignLeft = true;
        widgetComp.isAlignRight = true;
        // 最后调用 updateAlignment 使设置生效
        widgetComp.updateAlignment();
        // 6. 创建 Label 子节点
        const labelNode = new Node('Label');
        bgNode.addChild(labelNode);
        labelNode.setContentSize(width, height);
        labelNode.setAnchorPoint(0.5, 0.5);
        labelNode.color = cc.color(0, 0, 0, 255); // 黑色
        // 7. 添加 Label 组件
        const labelComp = labelNode.addComponent(cc.Label);
        labelComp.string = text;
        labelComp.fontSize = 20;
        labelComp.lineHeight = 40;
        labelComp.horizontalAlign = cc.Label.HorizontalAlign.CENTER;
        labelComp.verticalAlign = cc.Label.VerticalAlign.CENTER;
        // 8. 设置 Button 组件属性
        buttonComp.target = bgNode;
        buttonComp.transition = cc.Button.Transition.SPRITE;
        // 直接设置所有 4 个状态的 SpriteFrame UUID
        const normalSprite = new cc.SpriteFrame();
        normalSprite._uuid = sprites.normal;
        buttonComp.normalSprite = normalSprite;
        const pressedSprite = new cc.SpriteFrame();
        pressedSprite._uuid = sprites.pressed;
        buttonComp.pressedSprite = pressedSprite;
        const hoverSprite = new cc.SpriteFrame();
        hoverSprite._uuid = sprites.hover;
        buttonComp.hoverSprite = hoverSprite;
        const disabledSprite = new cc.SpriteFrame();
        disabledSprite._uuid = sprites.disabled;
        buttonComp.disabledSprite = disabledSprite;
        // 标记场景为已修改并保存
        markSceneDirty();
        // 通知编辑器刷新场景视图（让图片立即显示）
        try {
            if (typeof Editor !== 'undefined' && Editor.Ipc && Editor.Ipc.sendToPanel) {
                // 刷新场景视图
                Editor.Ipc.sendToPanel('scene', 'scene:soft-reload');
            }
        }
        catch (error) {
            console.warn('[scene-script] Failed to refresh scene view:', error);
        }
        return {
            success: true,
            message: `Button '${name}' created successfully with complete structure`,
            data: {
                uuid: buttonNode.uuid || buttonNode._id,
                name: buttonNode.name || buttonNode._name,
                width: width,
                height: height,
                sprites: {
                    normal: sprites.normal,
                    pressed: sprites.pressed,
                    hover: sprites.hover,
                    disabled: sprites.disabled
                },
                children: [
                    {
                        name: 'Background',
                        uuid: bgNode.uuid || bgNode._id,
                        components: ['cc.Sprite', 'cc.Widget']
                    },
                    {
                        name: 'Label',
                        uuid: labelNode.uuid || labelNode._id,
                        text: text,
                        components: ['cc.Label']
                    }
                ]
            }
        };
    }
    catch (error) {
        return {
            success: false,
            error: error.message || error
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnV0dG9uLWhhbmRsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2NlbmUtaGFuZGxlcnMvYnV0dG9uLWhhbmRsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFjSCw0REFvSkM7QUFoS0Q7Ozs7Ozs7Ozs7O0dBV0c7QUFDSCxTQUFnQix3QkFBd0IsQ0FDcEMsSUFBWSxFQUNaLFVBQXlCLEVBQ3pCLElBQVksRUFDWixLQUFhLEVBQ2IsTUFBYyxFQUNkLE9BQTZFLEVBQzdFLEtBQWdCLEVBQ2hCLGNBQTBCO0lBRTFCLElBQUksQ0FBQztRQUNELE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEdBQUcsS0FBSyxFQUFFLENBQUM7UUFDbkMsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNULE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxpQkFBaUIsRUFBRSxDQUFDO1FBQ3hELENBQUM7UUFFRCxXQUFXO1FBQ1gsTUFBTSxVQUFVLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsTUFBTSxNQUFNLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDckUsSUFBSSxNQUFNLEVBQUUsQ0FBQztZQUNULE1BQU0sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDaEMsQ0FBQzthQUFNLENBQUM7WUFDSixLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQy9CLENBQUM7UUFFRCxhQUFhO1FBQ2IsVUFBVSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDekMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUs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5bu65aSE55CG5ZmoXG4gKiDlnKjlnLrmma/ohJrmnKzkuIrkuIvmlofkuK3miafooYzvvIzlj6/ku6Xnm7TmjqXorr/pl64gY2Mg5a+56LGhXG4gKi9cblxuLyoqXG4gKiDliJvlu7rlrozmlbTnmoQgQnV0dG9uIFVJIOe7hOS7tlxuICog5YyF5ousIEJhY2tncm91bmQg5a2Q6IqC54K577yIU3ByaXRlICsgV2lkZ2V077yJ5ZKMIExhYmVsIOWtkOiKgueCuVxuICogQHBhcmFtIG5hbWUgQnV0dG9uIOiKgueCueWQjeensFxuICogQHBhcmFtIHBhcmVudFV1aWQg54i26IqC54K5IFVVSURcbiAqIEBwYXJhbSB0ZXh0IExhYmVsIOaWh+acrFxuICogQHBhcmFtIHdpZHRoIEJ1dHRvbiDlrr3luqZcbiAqIEBwYXJhbSBoZWlnaHQgQnV0dG9uIOmrmOW6plxuICogQHBhcmFtIHNwcml0ZXMg5YyF5ZCrIDQg5Liq54q25oCB55qE5Zu+6ZuGIFVVSUQ6IHtub3JtYWwsIHByZXNzZWQsIGhvdmVyLCBkaXNhYmxlZH1cbiAqIEBwYXJhbSBnZXRDQyDojrflj5YgQ29jb3Mg5byV5pOO5a6e5L6L55qE5Ye95pWwXG4gKiBAcGFyYW0gbWFya1NjZW5lRGlydHkg5qCH6K6w5Zy65pmv5Li66ISP55qE5Ye95pWwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVCdXR0b25XaXRoVGVtcGxhdGUoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHBhcmVudFV1aWQ6IHN0cmluZyB8IG51bGwsXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIHdpZHRoOiBudW1iZXIsXG4gICAgaGVpZ2h0OiBudW1iZXIsXG4gICAgc3ByaXRlczogeyBub3JtYWw6IHN0cmluZzsgcHJlc3NlZDogc3RyaW5nOyBob3Zlcjogc3RyaW5nOyBkaXNhYmxlZDogc3RyaW5nIH0sXG4gICAgZ2V0Q0M6ICgpID0+IGFueSxcbiAgICBtYXJrU2NlbmVEaXJ0eTogKCkgPT4gdm9pZFxuKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBkaXJlY3RvciwgTm9kZSB9ID0gZ2V0Q0MoKTtcbiAgICAgICAgY29uc3Qgc2NlbmUgPSBkaXJlY3Rvci5nZXRTY2VuZSgpO1xuICAgICAgICBpZiAoIXNjZW5lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyBhY3RpdmUgc2NlbmUnIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyAxLiDliJvlu7rkuLvoioLngrlcbiAgICAgICAgY29uc3QgYnV0dG9uTm9kZSA9IG5ldyBOb2RlKG5hbWUpO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBwYXJlbnRVdWlkID8gc2NlbmUuZ2V0Q2hpbGRCeVV1aWQocGFyZW50VXVpZCkgOiBzY2VuZTtcbiAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgICAgcGFyZW50LmFkZENoaWxkKGJ1dHRvbk5vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2NlbmUuYWRkQ2hpbGQoYnV0dG9uTm9kZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDorr7nva7kuLvoioLngrnlpKflsI/lkozplJrngrlcbiAgICAgICAgYnV0dG9uTm9kZS5zZXRDb250ZW50U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgYnV0dG9uTm9kZS5zZXRBbmNob3JQb2ludCgwLjUsIDAuNSk7XG5cbiAgICAgICAgLy8gMi4g5re75YqgIEJ1dHRvbiDnu4Tku7ZcbiAgICAgICAgY29uc3QgYnV0dG9uQ29tcCA9IGJ1dHRvbk5vZGUuYWRkQ29tcG9uZW50KGNjLkJ1dHRvbik7XG5cbiAgICAgICAgLy8gMy4g5Yib5bu6IEJhY2tncm91bmQg5a2Q6IqC54K5XG4gICAgICAgIGNvbnN0IGJnTm9kZSA9IG5ldyBOb2RlKCdCYWNrZ3JvdW5kJyk7XG4gICAgICAgIGJ1dHRvbk5vZGUuYWRkQ2hpbGQoYmdOb2RlKTtcbiAgICAgICAgYmdOb2RlLnNldENvbnRlbnRTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICBiZ05vZGUuc2V0QW5jaG9yUG9pbnQoMC41LCAwLjUpO1xuXG4gICAgICAgIC8vIDQuIOa3u+WKoCBTcHJpdGUg57uE5Lu25YiwIEJhY2tncm91bmRcbiAgICAgICAgY29uc3Qgc3ByaXRlQ29tcCA9IGJnTm9kZS5hZGRDb21wb25lbnQoY2MuU3ByaXRlKTtcbiAgICAgICAgc3ByaXRlQ29tcC50eXBlID0gY2MuU3ByaXRlLlR5cGUuU0xJQ0VEOyAvLyDkuZ3lrqvmoLzmqKHlvI9cbiAgICAgICAgc3ByaXRlQ29tcC5zaXplTW9kZSA9IGNjLlNwcml0ZS5TaXplTW9kZS5DVVNUT007IC8vIDAgLSBDVVNUT00g5qih5byPXG4gICAgICAgIFxuICAgICAgICAvLyDnm7TmjqXorr7nva4gU3ByaXRlRnJhbWUg55qEIFVVSUTvvIjmm7Tlj6/pnaDnmoTmlrnms5XvvIlcbiAgICAgICAgY29uc3Qgbm9ybWFsU3ByaXRlRnJhbWUgPSBuZXcgY2MuU3ByaXRlRnJhbWUoKTtcbiAgICAgICAgKG5vcm1hbFNwcml0ZUZyYW1lIGFzIGFueSkuX3V1aWQgPSBzcHJpdGVzLm5vcm1hbDtcbiAgICAgICAgc3ByaXRlQ29tcC5zcHJpdGVGcmFtZSA9IG5vcm1hbFNwcml0ZUZyYW1lO1xuXG4gICAgICAgIC8vIDUuIOa3u+WKoCBXaWRnZXQg57uE5Lu25YiwIEJhY2tncm91bmTvvIjlrozlhajlr7npvZDvvIlcbiAgICAgICAgY29uc3Qgd2lkZ2V0Q29tcCA9IGJnTm9kZS5hZGRDb21wb25lbnQoY2MuV2lkZ2V0KTtcbiAgICAgICAgLy8g6YeN6KaB77ya5YWI6K6+572u5a+56b2Q5YC877yM5YaN5ZCv55So5a+56b2Q5qCH5b+XXG4gICAgICAgIHdpZGdldENvbXAudG9wID0gMDtcbiAgICAgICAgd2lkZ2V0Q29tcC5ib3R0b20gPSAwO1xuICAgICAgICB3aWRnZXRDb21wLmxlZnQgPSAwO1xuICAgICAgICB3aWRnZXRDb21wLnJpZ2h0ID0gMDtcbiAgICAgICAgLy8g54S25ZCO5ZCv55So5a+56b2QXG4gICAgICAgIHdpZGdldENvbXAuaXNBbGlnblRvcCA9IHRydWU7XG4gICAgICAgIHdpZGdldENvbXAuaXNBbGlnbkJvdHRvbSA9IHRydWU7XG4gICAgICAgIHdpZGdldENvbXAuaXNBbGlnbkxlZnQgPSB0cnVlO1xuICAgICAgICB3aWRnZXRDb21wLmlzQWxpZ25SaWdodCA9IHRydWU7XG4gICAgICAgIC8vIOacgOWQjuiwg+eUqCB1cGRhdGVBbGlnbm1lbnQg5L2/6K6+572u55Sf5pWIXG4gICAgICAgIHdpZGdldENvbXAudXBkYXRlQWxpZ25tZW50KCk7XG5cbiAgICAgICAgLy8gNi4g5Yib5bu6IExhYmVsIOWtkOiKgueCuVxuICAgICAgICBjb25zdCBsYWJlbE5vZGUgPSBuZXcgTm9kZSgnTGFiZWwnKTtcbiAgICAgICAgYmdOb2RlLmFkZENoaWxkKGxhYmVsTm9kZSk7XG4gICAgICAgIGxhYmVsTm9kZS5zZXRDb250ZW50U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgbGFiZWxOb2RlLnNldEFuY2hvclBvaW50KDAuNSwgMC41KTtcbiAgICAgICAgbGFiZWxOb2RlLmNvbG9yID0gY2MuY29sb3IoMCwgMCwgMCwgMjU1KTsgLy8g6buR6ImyXG5cbiAgICAgICAgLy8gNy4g5re75YqgIExhYmVsIOe7hOS7tlxuICAgICAgICBjb25zdCBsYWJlbENvbXAgPSBsYWJlbE5vZGUuYWRkQ29tcG9uZW50KGNjLkxhYmVsKTtcbiAgICAgICAgbGFiZWxDb21wLnN0cmluZyA9IHRleHQ7XG4gICAgICAgIGxhYmVsQ29tcC5mb250U2l6ZSA9IDIwO1xuICAgICAgICBsYWJlbENvbXAubGluZUhlaWdodCA9IDQwO1xuICAgICAgICBsYWJlbENvbXAuaG9yaXpvbnRhbEFsaWduID0gY2MuTGFiZWwuSG9yaXpvbnRhbEFsaWduLkNFTlRFUjtcbiAgICAgICAgbGFiZWxDb21wLnZlcnRpY2FsQWxpZ24gPSBjYy5MYWJlbC5WZXJ0aWNhbEFsaWduLkNFTlRFUjtcblxuICAgICAgICAvLyA4LiDorr7nva4gQnV0dG9uIOe7hOS7tuWxnuaAp1xuICAgICAgICBidXR0b25Db21wLnRhcmdldCA9IGJnTm9kZTtcbiAgICAgICAgYnV0dG9uQ29tcC50cmFuc2l0aW9uID0gY2MuQnV0dG9uLlRyYW5zaXRpb24uU1BSSVRFO1xuICAgICAgICBcbiAgICAgICAgLy8g55u05o6l6K6+572u5omA5pyJIDQg5Liq54q25oCB55qEIFNwcml0ZUZyYW1lIFVVSURcbiAgICAgICAgY29uc3Qgbm9ybWFsU3ByaXRlID0gbmV3IGNjLlNwcml0ZUZyYW1lKCk7XG4gICAgICAgIChub3JtYWxTcHJpdGUgYXMgYW55KS5fdXVpZCA9IHNwcml0ZXMubm9ybWFsO1xuICAgICAgICBidXR0b25Db21wLm5vcm1hbFNwcml0ZSA9IG5vcm1hbFNwcml0ZTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHByZXNzZWRTcHJpdGUgPSBuZXcgY2MuU3ByaXRlRnJhbWUoKTtcbiAgICAgICAgKHByZXNzZWRTcHJpdGUgYXMgYW55KS5fdXVpZCA9IHNwcml0ZXMucHJlc3NlZDtcbiAgICAgICAgYnV0dG9uQ29tcC5wcmVzc2VkU3ByaXRlID0gcHJlc3NlZFNwcml0ZTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGhvdmVyU3ByaXRlID0gbmV3IGNjLlNwcml0ZUZyYW1lKCk7XG4gICAgICAgIChob3ZlclNwcml0ZSBhcyBhbnkpLl91dWlkID0gc3ByaXRlcy5ob3ZlcjtcbiAgICAgICAgYnV0dG9uQ29tcC5ob3ZlclNwcml0ZSA9IGhvdmVyU3ByaXRlO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZGlzYWJsZWRTcHJpdGUgPSBuZXcgY2MuU3ByaXRlRnJhbWUoKTtcbiAgICAgICAgKGRpc2FibGVkU3ByaXRlIGFzIGFueSkuX3V1aWQgPSBzcHJpdGVzLmRpc2FibGVkO1xuICAgICAgICBidXR0b25Db21wLmRpc2FibGVkU3ByaXRlID0gZGlzYWJsZWRTcHJpdGU7XG5cbiAgICAgICAgLy8g5qCH6K6w5Zy65pmv5Li65bey5L+u5pS55bm25L+d5a2YXG4gICAgICAgIG1hcmtTY2VuZURpcnR5KCk7XG4gICAgICAgIFxuICAgICAgICAvLyDpgJrnn6XnvJbovpHlmajliLfmlrDlnLrmma/op4blm77vvIjorqnlm77niYfnq4vljbPmmL7npLrvvIlcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgRWRpdG9yICE9PSAndW5kZWZpbmVkJyAmJiBFZGl0b3IuSXBjICYmIEVkaXRvci5JcGMuc2VuZFRvUGFuZWwpIHtcbiAgICAgICAgICAgICAgICAvLyDliLfmlrDlnLrmma/op4blm75cbiAgICAgICAgICAgICAgICBFZGl0b3IuSXBjLnNlbmRUb1BhbmVsKCdzY2VuZScsICdzY2VuZTpzb2Z0LXJlbG9hZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdbc2NlbmUtc2NyaXB0XSBGYWlsZWQgdG8gcmVmcmVzaCBzY2VuZSB2aWV3OicsIGVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgbWVzc2FnZTogYEJ1dHRvbiAnJHtuYW1lfScgY3JlYXRlZCBzdWNjZXNzZnVsbHkgd2l0aCBjb21wbGV0ZSBzdHJ1Y3R1cmVgLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHV1aWQ6IGJ1dHRvbk5vZGUudXVpZCB8fCBidXR0b25Ob2RlLl9pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBidXR0b25Ob2RlLm5hbWUgfHwgYnV0dG9uTm9kZS5fbmFtZSxcbiAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICAgICAgc3ByaXRlczoge1xuICAgICAgICAgICAgICAgICAgICBub3JtYWw6IHNwcml0ZXMubm9ybWFsLFxuICAgICAgICAgICAgICAgICAgICBwcmVzc2VkOiBzcHJpdGVzLnByZXNzZWQsXG4gICAgICAgICAgICAgICAgICAgIGhvdmVyOiBzcHJpdGVzLmhvdmVyLFxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogc3ByaXRlcy5kaXNhYmxlZFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0JhY2tncm91bmQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogYmdOb2RlLnV1aWQgfHwgYmdOb2RlLl9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHM6IFsnY2MuU3ByaXRlJywgJ2NjLldpZGdldCddXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdMYWJlbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBsYWJlbE5vZGUudXVpZCB8fCBsYWJlbE5vZGUuX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHM6IFsnY2MuTGFiZWwnXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgZXJyb3JcbiAgICAgICAgfTtcbiAgICB9XG59XG4iXX0=