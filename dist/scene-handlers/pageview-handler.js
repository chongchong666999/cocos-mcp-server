"use strict";
/**
 * PageView UI 创建处理器
 * 在场景脚本上下文中执行，可以直接访问 cc 对象
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createPageViewWithTemplate = createPageViewWithTemplate;
function createPageViewWithTemplate(name, parentUuid, width, height, getCC, markSceneDirty) {
    var _a;
    try {
        const { director, Node, color } = getCC();
        const scene = director.getScene();
        if (!scene) {
            return { success: false, error: 'No active scene' };
        }
        const BG_SPRITE = '9bbda31e-ad49-43c9-aaf2-f7d9896bac69';
        const INDICATOR_SPRITE = 'c9fa51ff-3f01-4601-8f80-325d1b11dab7';
        // 1. 主节点
        const pageViewNode = new Node(name);
        const parent = parentUuid ? scene.getChildByUuid(parentUuid) : scene;
        (parent || scene).addChild(pageViewNode);
        pageViewNode.setContentSize(width, height);
        pageViewNode.setAnchorPoint(0.5, 0.5);
        // 2. 背景
        const bgNode = new Node('background');
        pageViewNode.addChild(bgNode);
        bgNode.setContentSize(width, height);
        bgNode.setAnchorPoint(0.5, 0.5);
        const bgSprite = bgNode.addComponent(cc.Sprite);
        bgSprite.type = cc.Sprite.Type.SLICED;
        bgSprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;
        const bgFrame = new cc.SpriteFrame();
        bgFrame._uuid = BG_SPRITE;
        bgSprite.spriteFrame = bgFrame;
        // 3. view + mask
        const viewNode = new Node('view');
        pageViewNode.addChild(viewNode);
        viewNode.setContentSize(width, height);
        viewNode.setAnchorPoint(0.5, 0.5);
        const mask = viewNode.addComponent(cc.Mask);
        mask.type = cc.Mask.Type.RECT;
        // 4. content + pages
        const contentNode = new Node('content');
        viewNode.addChild(contentNode);
        contentNode.setContentSize(width * 3, height);
        contentNode.setAnchorPoint(0, 0.5);
        contentNode.setPosition(-width / 2, 0);
        const layout = contentNode.addComponent(cc.Layout);
        layout.type = cc.Layout.Type.HORIZONTAL;
        layout.resizeMode = cc.Layout.ResizeMode.CONTAINER;
        layout.spacingY = 15; // 与 helloworld 数据一致
        const PAGE_SIZE = { width, height: height - 60 };
        const pageColors = [
            color(255, 200, 200, 255),
            color(200, 255, 200, 255),
            color(200, 200, 255, 255)
        ];
        const pagePositions = [width / 2, width * 1.5, width * 2.5];
        for (let i = 0; i < 3; i++) {
            const pageNode = new Node(`page_${i + 1}`);
            contentNode.addChild(pageNode);
            pageNode.setContentSize(PAGE_SIZE.width, PAGE_SIZE.height);
            pageNode.setAnchorPoint(0.5, 0.5);
            pageNode.setPosition(pagePositions[i], 0);
            pageNode.color = pageColors[i];
            const pageSprite = pageNode.addComponent(cc.Sprite);
            pageSprite.type = cc.Sprite.Type.SLICED;
            pageSprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;
            const frame = new cc.SpriteFrame();
            frame._uuid = BG_SPRITE;
            pageSprite.spriteFrame = frame;
        }
        // 5. indicator
        const indicatorNode = new Node('indicator');
        pageViewNode.addChild(indicatorNode);
        indicatorNode.setContentSize(100, 27);
        indicatorNode.setAnchorPoint(0.5, 0.5);
        indicatorNode.setPosition(0, -160);
        const indicatorComp = indicatorNode.addComponent(cc.PageViewIndicator);
        indicatorComp.direction = cc.PageViewIndicator.Direction.HORIZONTAL;
        indicatorComp.spacing = 10;
        indicatorComp.cellSize = { width: 10, height: 10 };
        const indicatorFrame = new cc.SpriteFrame();
        indicatorFrame._uuid = INDICATOR_SPRITE;
        indicatorComp.spriteFrame = indicatorFrame;
        // 6. PageView 组件
        const pageViewComp = pageViewNode.addComponent(cc.PageView);
        pageViewComp.content = contentNode;
        pageViewComp.sizeMode = cc.PageView.SizeMode.Unified;
        pageViewComp.direction = cc.PageView.Direction.Horizontal;
        pageViewComp.indicator = indicatorComp;
        pageViewComp.horizontal = true;
        pageViewComp.vertical = true;
        pageViewComp.inertia = true;
        pageViewComp.brake = 0.5;
        pageViewComp.elastic = true;
        pageViewComp.bounceDuration = 0.5;
        pageViewComp.cancelInnerEvents = true;
        pageViewComp.scrollThreshold = 0.5;
        pageViewComp.autoPageTurningThreshold = 100;
        pageViewComp.pageTurningEventTiming = 0.1;
        pageViewComp.pageTurningSpeed = 0.3;
        // 建立 indicator 与 pageView 关联
        indicatorComp.setPageView(pageViewComp);
        markSceneDirty();
        try {
            if (typeof Editor !== 'undefined' && ((_a = Editor.Ipc) === null || _a === void 0 ? void 0 : _a.sendToPanel)) {
                Editor.Ipc.sendToPanel('scene', 'scene:soft-reload');
            }
        }
        catch (error) {
            console.warn('[scene-script] Failed to refresh scene view:', error);
        }
        return {
            success: true,
            message: `PageView '${name}' created successfully`,
            data: {
                uuid: pageViewNode.uuid || pageViewNode._id,
                name: pageViewNode.name || pageViewNode._name,
                width,
                height
            }
        };
    }
    catch (error) {
        return { success: false, error: error.message || error };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZXZpZXctaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY2VuZS1oYW5kbGVycy9wYWdldmlldy1oYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsZ0VBMklDO0FBM0lELFNBQWdCLDBCQUEwQixDQUN0QyxJQUFZLEVBQ1osVUFBeUIsRUFDekIsS0FBYSxFQUNiLE1BQWMsRUFDZCxLQUFnQixFQUNoQixjQUEwQjs7SUFFMUIsSUFBSSxDQUFDO1FBQ0QsTUFBTSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsS0FBSyxFQUFFLENBQUM7UUFDMUMsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNULE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxpQkFBaUIsRUFBRSxDQUFDO1FBQ3hELENBQUM7UUFFRCxNQUFNLFNBQVMsR0FBRyxzQ0FBc0MsQ0FBQztRQUN6RCxNQUFNLGdCQUFnQixHQUFHLHNDQUFzQyxDQUFDO1FBRWhFLFNBQVM7UUFDVCxNQUFNLFlBQVksR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQyxNQUFNLE1BQU0sR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUNyRSxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDekMsWUFBWSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDM0MsWUFBWSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFdEMsUUFBUTtRQUNSLE1BQU0sTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3RDLFlBQVksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDckMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDaEMsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEQsUUFBUSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDdEMsUUFBUSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDOUMsTUFBTSxPQUFPLEdBQUcsSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDcEMsT0FBZSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7UUFDbkMsUUFBUSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7UUFFL0IsaUJBQWlCO1FBQ2pCLE1BQU0sUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xDLFlBQVksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDdkMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDbEMsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7UUFFOUIscUJBQXFCO1FBQ3JCLE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FB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QUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBhZ2VWaWV3IFVJIOWIm+W7uuWkhOeQhuWZqFxuICog5Zyo5Zy65pmv6ISa5pys5LiK5LiL5paH5Lit5omn6KGM77yM5Y+v5Lul55u05o6l6K6/6ZeuIGNjIOWvueixoVxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVQYWdlVmlld1dpdGhUZW1wbGF0ZShcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgcGFyZW50VXVpZDogc3RyaW5nIHwgbnVsbCxcbiAgICB3aWR0aDogbnVtYmVyLFxuICAgIGhlaWdodDogbnVtYmVyLFxuICAgIGdldENDOiAoKSA9PiBhbnksXG4gICAgbWFya1NjZW5lRGlydHk6ICgpID0+IHZvaWRcbikge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgZGlyZWN0b3IsIE5vZGUsIGNvbG9yIH0gPSBnZXRDQygpO1xuICAgICAgICBjb25zdCBzY2VuZSA9IGRpcmVjdG9yLmdldFNjZW5lKCk7XG4gICAgICAgIGlmICghc2NlbmUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIGFjdGl2ZSBzY2VuZScgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IEJHX1NQUklURSA9ICc5YmJkYTMxZS1hZDQ5LTQzYzktYWFmMi1mN2Q5ODk2YmFjNjknO1xuICAgICAgICBjb25zdCBJTkRJQ0FUT1JfU1BSSVRFID0gJ2M5ZmE1MWZmLTNmMDEtNDYwMS04ZjgwLTMyNWQxYjExZGFiNyc7XG5cbiAgICAgICAgLy8gMS4g5Li76IqC54K5XG4gICAgICAgIGNvbnN0IHBhZ2VWaWV3Tm9kZSA9IG5ldyBOb2RlKG5hbWUpO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBwYXJlbnRVdWlkID8gc2NlbmUuZ2V0Q2hpbGRCeVV1aWQocGFyZW50VXVpZCkgOiBzY2VuZTtcbiAgICAgICAgKHBhcmVudCB8fCBzY2VuZSkuYWRkQ2hpbGQocGFnZVZpZXdOb2RlKTtcbiAgICAgICAgcGFnZVZpZXdOb2RlLnNldENvbnRlbnRTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICBwYWdlVmlld05vZGUuc2V0QW5jaG9yUG9pbnQoMC41LCAwLjUpO1xuXG4gICAgICAgIC8vIDIuIOiDjOaZr1xuICAgICAgICBjb25zdCBiZ05vZGUgPSBuZXcgTm9kZSgnYmFja2dyb3VuZCcpO1xuICAgICAgICBwYWdlVmlld05vZGUuYWRkQ2hpbGQoYmdOb2RlKTtcbiAgICAgICAgYmdOb2RlLnNldENvbnRlbnRTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICBiZ05vZGUuc2V0QW5jaG9yUG9pbnQoMC41LCAwLjUpO1xuICAgICAgICBjb25zdCBiZ1Nwcml0ZSA9IGJnTm9kZS5hZGRDb21wb25lbnQoY2MuU3ByaXRlKTtcbiAgICAgICAgYmdTcHJpdGUudHlwZSA9IGNjLlNwcml0ZS5UeXBlLlNMSUNFRDtcbiAgICAgICAgYmdTcHJpdGUuc2l6ZU1vZGUgPSBjYy5TcHJpdGUuU2l6ZU1vZGUuQ1VTVE9NO1xuICAgICAgICBjb25zdCBiZ0ZyYW1lID0gbmV3IGNjLlNwcml0ZUZyYW1lKCk7XG4gICAgICAgIChiZ0ZyYW1lIGFzIGFueSkuX3V1aWQgPSBCR19TUFJJVEU7XG4gICAgICAgIGJnU3ByaXRlLnNwcml0ZUZyYW1lID0gYmdGcmFtZTtcblxuICAgICAgICAvLyAzLiB2aWV3ICsgbWFza1xuICAgICAgICBjb25zdCB2aWV3Tm9kZSA9IG5ldyBOb2RlKCd2aWV3Jyk7XG4gICAgICAgIHBhZ2VWaWV3Tm9kZS5hZGRDaGlsZCh2aWV3Tm9kZSk7XG4gICAgICAgIHZpZXdOb2RlLnNldENvbnRlbnRTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB2aWV3Tm9kZS5zZXRBbmNob3JQb2ludCgwLjUsIDAuNSk7XG4gICAgICAgIGNvbnN0IG1hc2sgPSB2aWV3Tm9kZS5hZGRDb21wb25lbnQoY2MuTWFzayk7XG4gICAgICAgIG1hc2sudHlwZSA9IGNjLk1hc2suVHlwZS5SRUNUO1xuXG4gICAgICAgIC8vIDQuIGNvbnRlbnQgKyBwYWdlc1xuICAgICAgICBjb25zdCBjb250ZW50Tm9kZSA9IG5ldyBOb2RlKCdjb250ZW50Jyk7XG4gICAgICAgIHZpZXdOb2RlLmFkZENoaWxkKGNvbnRlbnROb2RlKTtcbiAgICAgICAgY29udGVudE5vZGUuc2V0Q29udGVudFNpemUod2lkdGggKiAzLCBoZWlnaHQpO1xuICAgICAgICBjb250ZW50Tm9kZS5zZXRBbmNob3JQb2ludCgwLCAwLjUpO1xuICAgICAgICBjb250ZW50Tm9kZS5zZXRQb3NpdGlvbigtd2lkdGggLyAyLCAwKTtcblxuICAgICAgICBjb25zdCBsYXlvdXQgPSBjb250ZW50Tm9kZS5hZGRDb21wb25lbnQoY2MuTGF5b3V0KTtcbiAgICAgICAgbGF5b3V0LnR5cGUgPSBjYy5MYXlvdXQuVHlwZS5IT1JJWk9OVEFMO1xuICAgICAgICBsYXlvdXQucmVzaXplTW9kZSA9IGNjLkxheW91dC5SZXNpemVNb2RlLkNPTlRBSU5FUjtcbiAgICAgICAgbGF5b3V0LnNwYWNpbmdZID0gMTU7IC8vIOS4jiBoZWxsb3dvcmxkIOaVsOaNruS4gOiHtFxuXG4gICAgICAgIGNvbnN0IFBBR0VfU0laRSA9IHsgd2lkdGgsIGhlaWdodDogaGVpZ2h0IC0gNjAgfTtcbiAgICAgICAgY29uc3QgcGFnZUNvbG9ycyA9IFtcbiAgICAgICAgICAgIGNvbG9yKDI1NSwgMjAwLCAyMDAsIDI1NSksXG4gICAgICAgICAgICBjb2xvcigyMDAsIDI1NSwgMjAwLCAyNTUpLFxuICAgICAgICAgICAgY29sb3IoMjAwLCAyMDAsIDI1NSwgMjU1KVxuICAgICAgICBdO1xuXG4gICAgICAgIGNvbnN0IHBhZ2VQb3NpdGlvbnMgPSBbd2lkdGggLyAyLCB3aWR0aCAqIDEuNSwgd2lkdGggKiAyLjVdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcGFnZU5vZGUgPSBuZXcgTm9kZShgcGFnZV8ke2kgKyAxfWApO1xuICAgICAgICAgICAgY29udGVudE5vZGUuYWRkQ2hpbGQocGFnZU5vZGUpO1xuICAgICAgICAgICAgcGFnZU5vZGUuc2V0Q29udGVudFNpemUoUEFHRV9TSVpFLndpZHRoLCBQQUdFX1NJWkUuaGVpZ2h0KTtcbiAgICAgICAgICAgIHBhZ2VOb2RlLnNldEFuY2hvclBvaW50KDAuNSwgMC41KTtcbiAgICAgICAgICAgIHBhZ2VOb2RlLnNldFBvc2l0aW9uKHBhZ2VQb3NpdGlvbnNbaV0sIDApO1xuICAgICAgICAgICAgcGFnZU5vZGUuY29sb3IgPSBwYWdlQ29sb3JzW2ldO1xuXG4gICAgICAgICAgICBjb25zdCBwYWdlU3ByaXRlID0gcGFnZU5vZGUuYWRkQ29tcG9uZW50KGNjLlNwcml0ZSk7XG4gICAgICAgICAgICBwYWdlU3ByaXRlLnR5cGUgPSBjYy5TcHJpdGUuVHlwZS5TTElDRUQ7XG4gICAgICAgICAgICBwYWdlU3ByaXRlLnNpemVNb2RlID0gY2MuU3ByaXRlLlNpemVNb2RlLkNVU1RPTTtcbiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gbmV3IGNjLlNwcml0ZUZyYW1lKCk7XG4gICAgICAgICAgICAoZnJhbWUgYXMgYW55KS5fdXVpZCA9IEJHX1NQUklURTtcbiAgICAgICAgICAgIHBhZ2VTcHJpdGUuc3ByaXRlRnJhbWUgPSBmcmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIDUuIGluZGljYXRvclxuICAgICAgICBjb25zdCBpbmRpY2F0b3JOb2RlID0gbmV3IE5vZGUoJ2luZGljYXRvcicpO1xuICAgICAgICBwYWdlVmlld05vZGUuYWRkQ2hpbGQoaW5kaWNhdG9yTm9kZSk7XG4gICAgICAgIGluZGljYXRvck5vZGUuc2V0Q29udGVudFNpemUoMTAwLCAyNyk7XG4gICAgICAgIGluZGljYXRvck5vZGUuc2V0QW5jaG9yUG9pbnQoMC41LCAwLjUpO1xuICAgICAgICBpbmRpY2F0b3JOb2RlLnNldFBvc2l0aW9uKDAsIC0xNjApO1xuXG4gICAgICAgIGNvbnN0IGluZGljYXRvckNvbXAgPSBpbmRpY2F0b3JOb2RlLmFkZENvbXBvbmVudChjYy5QYWdlVmlld0luZGljYXRvcik7XG4gICAgICAgIGluZGljYXRvckNvbXAuZGlyZWN0aW9uID0gY2MuUGFnZVZpZXdJbmRpY2F0b3IuRGlyZWN0aW9uLkhPUklaT05UQUw7XG4gICAgICAgIGluZGljYXRvckNvbXAuc3BhY2luZyA9IDEwO1xuICAgICAgICBpbmRpY2F0b3JDb21wLmNlbGxTaXplID0geyB3aWR0aDogMTAsIGhlaWdodDogMTAgfSBhcyBhbnk7XG4gICAgICAgIGNvbnN0IGluZGljYXRvckZyYW1lID0gbmV3IGNjLlNwcml0ZUZyYW1lKCk7XG4gICAgICAgIChpbmRpY2F0b3JGcmFtZSBhcyBhbnkpLl91dWlkID0gSU5ESUNBVE9SX1NQUklURTtcbiAgICAgICAgaW5kaWNhdG9yQ29tcC5zcHJpdGVGcmFtZSA9IGluZGljYXRvckZyYW1lO1xuXG4gICAgICAgIC8vIDYuIFBhZ2VWaWV3IOe7hOS7tlxuICAgICAgICBjb25zdCBwYWdlVmlld0NvbXAgPSBwYWdlVmlld05vZGUuYWRkQ29tcG9uZW50KGNjLlBhZ2VWaWV3KTtcbiAgICAgICAgcGFnZVZpZXdDb21wLmNvbnRlbnQgPSBjb250ZW50Tm9kZTtcbiAgICAgICAgcGFnZVZpZXdDb21wLnNpemVNb2RlID0gY2MuUGFnZVZpZXcuU2l6ZU1vZGUuVW5pZmllZDtcbiAgICAgICAgcGFnZVZpZXdDb21wLmRpcmVjdGlvbiA9IGNjLlBhZ2VWaWV3LkRpcmVjdGlvbi5Ib3Jpem9udGFsO1xuICAgICAgICBwYWdlVmlld0NvbXAuaW5kaWNhdG9yID0gaW5kaWNhdG9yQ29tcDtcbiAgICAgICAgcGFnZVZpZXdDb21wLmhvcml6b250YWwgPSB0cnVlO1xuICAgICAgICBwYWdlVmlld0NvbXAudmVydGljYWwgPSB0cnVlO1xuICAgICAgICBwYWdlVmlld0NvbXAuaW5lcnRpYSA9IHRydWU7XG4gICAgICAgIHBhZ2VWaWV3Q29tcC5icmFrZSA9IDAuNTtcbiAgICAgICAgcGFnZVZpZXdDb21wLmVsYXN0aWMgPSB0cnVlO1xuICAgICAgICBwYWdlVmlld0NvbXAuYm91bmNlRHVyYXRpb24gPSAwLjU7XG4gICAgICAgIHBhZ2VWaWV3Q29tcC5jYW5jZWxJbm5lckV2ZW50cyA9IHRydWU7XG4gICAgICAgIHBhZ2VWaWV3Q29tcC5zY3JvbGxUaHJlc2hvbGQgPSAwLjU7XG4gICAgICAgIHBhZ2VWaWV3Q29tcC5hdXRvUGFnZVR1cm5pbmdUaHJlc2hvbGQgPSAxMDA7XG4gICAgICAgIHBhZ2VWaWV3Q29tcC5wYWdlVHVybmluZ0V2ZW50VGltaW5nID0gMC4xO1xuICAgICAgICBwYWdlVmlld0NvbXAucGFnZVR1cm5pbmdTcGVlZCA9IDAuMztcblxuICAgICAgICAvLyDlu7rnq4sgaW5kaWNhdG9yIOS4jiBwYWdlVmlldyDlhbPogZRcbiAgICAgICAgaW5kaWNhdG9yQ29tcC5zZXRQYWdlVmlldyhwYWdlVmlld0NvbXApO1xuXG4gICAgICAgIG1hcmtTY2VuZURpcnR5KCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIEVkaXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYgRWRpdG9yLklwYz8uc2VuZFRvUGFuZWwpIHtcbiAgICAgICAgICAgICAgICBFZGl0b3IuSXBjLnNlbmRUb1BhbmVsKCdzY2VuZScsICdzY2VuZTpzb2Z0LXJlbG9hZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdbc2NlbmUtc2NyaXB0XSBGYWlsZWQgdG8gcmVmcmVzaCBzY2VuZSB2aWV3OicsIGVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgbWVzc2FnZTogYFBhZ2VWaWV3ICcke25hbWV9JyBjcmVhdGVkIHN1Y2Nlc3NmdWxseWAsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdXVpZDogcGFnZVZpZXdOb2RlLnV1aWQgfHwgcGFnZVZpZXdOb2RlLl9pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBwYWdlVmlld05vZGUubmFtZSB8fCBwYWdlVmlld05vZGUuX25hbWUsXG4gICAgICAgICAgICAgICAgd2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgZXJyb3IgfTtcbiAgICB9XG59XG4iXX0=