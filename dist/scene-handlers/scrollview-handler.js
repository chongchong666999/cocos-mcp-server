"use strict";
/**
 * ScrollView UI 创建处理器
 * 在场景脚本上下文中执行，可以直接访问 cc 对象
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createScrollViewWithTemplate = createScrollViewWithTemplate;
/**
 * 创建 ScrollView 组件
 * 结构:
 * - ScrollView (Sprite, ScrollView)
 *   - scrollBar (Sprite, Scrollbar, Widget)
 *     - bar (Sprite)
 *   - view (Mask)
 *     - content
 *       - item (Label)
 *
 * @param name ScrollView 节点名称
 * @param parentUuid 父节点 UUID
 * @param width 宽度
 * @param height 高度
 * @param spriteFrameUuid 背景 Sprite Frame UUID
 * @param getCC 获取 Cocos 引擎实例的函数
 * @param markSceneDirty 标记场景为脏的函数
 */
function createScrollViewWithTemplate(name, parentUuid, width, height, spriteFrameUuid, getCC, markSceneDirty) {
    try {
        const { director, Node, color } = getCC();
        const scene = director.getScene();
        if (!scene) {
            return { success: false, error: 'No active scene' };
        }
        const BACKGROUND_SPRITE = spriteFrameUuid || '9bbda31e-ad49-43c9-aaf2-f7d9896bac69';
        const SCROLLBAR_SPRITE = '5fe5dcaa-b513-4dc5-a166-573627b3a159';
        const SCROLLBAR_HANDLE_SPRITE = '5c3bb932-6c3c-468f-88a9-c8c61d458641';
        const ITEM_TEXT = 'ScrollView content\n\n';
        const SCROLLBAR_WIDTH = 12;
        const HANDLE_SIZE = { width: 10, height: 30 };
        const CONTENT_PADDING = 10;
        const CONTENT_EXTRA_HEIGHT = 150; // 250(view height) -> 400(content height) in helloworld
        // 1. 创建主节点 (ScrollView)
        const scrollViewNode = new Node(name);
        const parent = parentUuid ? scene.getChildByUuid(parentUuid) : scene;
        if (parent) {
            parent.addChild(scrollViewNode);
        }
        else {
            scene.addChild(scrollViewNode);
        }
        scrollViewNode.setContentSize(width, height);
        scrollViewNode.setAnchorPoint(0.5, 0.5);
        scrollViewNode.active = true;
        // 添加背景 Sprite
        const spriteComp = scrollViewNode.addComponent(cc.Sprite);
        spriteComp.type = cc.Sprite.Type.SLICED;
        spriteComp.sizeMode = cc.Sprite.SizeMode.CUSTOM;
        const spriteFrame = new cc.SpriteFrame();
        spriteFrame._uuid = BACKGROUND_SPRITE;
        spriteComp.spriteFrame = spriteFrame;
        // 2. 创建 ScrollView 组件
        const scrollViewComp = scrollViewNode.addComponent(cc.ScrollView);
        scrollViewComp.horizontal = false;
        scrollViewComp.vertical = true;
        scrollViewComp.inertia = true;
        scrollViewComp.brake = 0.75;
        scrollViewComp.elastic = true;
        scrollViewComp.bounceDuration = 0.23;
        scrollViewComp.cancelInnerEvents = true;
        // 3. 创建 view 节点 (Mask)
        const viewNode = new Node('view');
        scrollViewNode.addChild(viewNode);
        viewNode.setContentSize(width, height);
        viewNode.setAnchorPoint(0.5, 0.5);
        viewNode.setPosition(0, 0);
        // 添加 Mask 组件
        const maskComp = viewNode.addComponent(cc.Mask);
        maskComp.type = cc.Mask.Type.RECT;
        // 4. 创建 content 节点
        const contentNode = new Node('content');
        viewNode.addChild(contentNode);
        const contentWidth = Math.max(width - CONTENT_PADDING * 2, 0);
        const contentHeight = Math.max(height + CONTENT_EXTRA_HEIGHT, height);
        contentNode.setContentSize(contentWidth, contentHeight);
        contentNode.setAnchorPoint(0.5, 1);
        contentNode.setPosition(0, height / 2 - CONTENT_PADDING);
        // 5. 创建 item 节点 + Label
        const itemNode = new Node('item');
        contentNode.addChild(itemNode);
        itemNode.setAnchorPoint(0, 1);
        itemNode.setPosition(-contentWidth / 2 + CONTENT_PADDING - 2, -CONTENT_PADDING);
        itemNode.color = color(0, 0, 0, 255);
        const labelComp = itemNode.addComponent(cc.Label);
        labelComp.string = ITEM_TEXT;
        labelComp.fontSize = 16;
        labelComp.lineHeight = 20;
        labelComp.enableWrapText = true;
        labelComp.horizontalAlign = cc.Label.HorizontalAlign.CENTER;
        labelComp.verticalAlign = cc.Label.VerticalAlign.TOP;
        // 让节点尺寸跟随文本内容，和 helloworld 场景一致
        if (typeof labelComp._forceUpdateRenderData === 'function') {
            labelComp._forceUpdateRenderData(true);
        }
        else if (typeof labelComp._updateRenderData === 'function') {
            labelComp._updateRenderData(true);
        }
        const measuredSize = itemNode.getContentSize();
        if (measuredSize && measuredSize.width > 0 && measuredSize.height > 0) {
            itemNode.setContentSize(measuredSize.width, measuredSize.height);
        }
        else {
            itemNode.setContentSize(contentWidth * 0.6, labelComp.lineHeight * 3 + CONTENT_PADDING);
        }
        // 6. 创建 ScrollBar 及滑块
        const scrollBarNode = new Node('scrollBar');
        scrollViewNode.addChild(scrollBarNode);
        scrollBarNode.setContentSize(SCROLLBAR_WIDTH, height);
        scrollBarNode.setAnchorPoint(1, 0.5);
        scrollBarNode.setPosition(width / 2, 0);
        // ScrollBar 背景
        const scrollBarSprite = scrollBarNode.addComponent(cc.Sprite);
        scrollBarSprite.type = cc.Sprite.Type.SLICED;
        scrollBarSprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;
        const scrollBarFrame = new cc.SpriteFrame();
        scrollBarFrame._uuid = SCROLLBAR_SPRITE;
        scrollBarSprite.spriteFrame = scrollBarFrame;
        // ScrollBar 对齐
        const scrollBarWidget = scrollBarNode.addComponent(cc.Widget);
        scrollBarWidget.isAlignRight = true;
        scrollBarWidget.isAlignTop = true;
        scrollBarWidget.isAlignBottom = true;
        scrollBarWidget.right = 0;
        scrollBarWidget.top = 0;
        scrollBarWidget.bottom = 0;
        scrollBarWidget.updateAlignment();
        scrollBarNode.setSiblingIndex(0); // 与 helloworld 场景的子节点顺序保持一致
        // 滑块
        const barNode = new Node('bar');
        scrollBarNode.addChild(barNode);
        barNode.setContentSize(HANDLE_SIZE.width, HANDLE_SIZE.height);
        barNode.setAnchorPoint(1, 0);
        barNode.setPosition(-1, 0);
        const barSprite = barNode.addComponent(cc.Sprite);
        barSprite.type = cc.Sprite.Type.SLICED;
        barSprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;
        const barSpriteFrame = new cc.SpriteFrame();
        barSpriteFrame._uuid = SCROLLBAR_HANDLE_SPRITE;
        barSprite.spriteFrame = barSpriteFrame;
        // ScrollBar 组件
        const scrollBarComp = scrollBarNode.addComponent(cc.Scrollbar);
        scrollBarComp.handle = barSprite;
        scrollBarComp.direction = cc.Scrollbar.Direction.VERTICAL;
        scrollBarComp.enableAutoHide = true;
        scrollBarComp.autoHideTime = 1;
        scrollBarComp.scrollView = scrollViewComp;
        // 7. 关联 ScrollView 内容与滚动条
        scrollViewComp.content = contentNode;
        scrollViewComp.verticalScrollBar = scrollBarComp;
        // 标记场景为已修改并保存
        markSceneDirty();
        // 通知编辑器刷新场景视图
        try {
            if (typeof Editor !== 'undefined' && Editor.Ipc && Editor.Ipc.sendToPanel) {
                Editor.Ipc.sendToPanel('scene', 'scene:soft-reload');
            }
        }
        catch (error) {
            console.warn('[scene-script] Failed to refresh scene view:', error);
        }
        return {
            success: true,
            message: `ScrollView '${name}' created successfully`,
            data: {
                uuid: scrollViewNode.uuid || scrollViewNode._id,
                name: scrollViewNode.name || scrollViewNode._name,
                width: width,
                height: height
            }
        };
    }
    catch (error) {
        return {
            success: false,
            error: error.message || error
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsdmlldy1oYW5kbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NjZW5lLWhhbmRsZXJzL3Njcm9sbHZpZXctaGFuZGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOztBQW9CSCxvRUE0TEM7QUE5TUQ7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHO0FBQ0gsU0FBZ0IsNEJBQTRCLENBQ3hDLElBQVksRUFDWixVQUF5QixFQUN6QixLQUFhLEVBQ2IsTUFBYyxFQUNkLGVBQXVCLEVBQ3ZCLEtBQWdCLEVBQ2hCLGNBQTBCO0lBRTFCLElBQUksQ0FBQztRQUNELE1BQU0sRUFDRixRQUFRLEVBQ1IsSUFBSSxFQUNKLEtBQUssRUFDUixHQUFHLEtBQUssRUFBRSxDQUFDO1FBQ1osTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNULE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxpQkFBaUIsRUFBRSxDQUFDO1FBQ3hELENBQUM7UUFFRCxNQUFNLGlCQUFpQixHQUFHLGVBQWUsSUFBSSxzQ0FBc0MsQ0FBQztRQUNwRixNQUFNLGdCQUFnQixHQUFHLHNDQUFzQyxDQUFDO1FBQ2hFLE1BQU0sdUJBQXVCLEdBQUcsc0NBQXNDLENBQUM7UUFDdkUsTUFBTSxTQUFTLEdBQUcsd0JBQXdCLENBQUM7UUFDM0MsTUFBTSxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzNCLE1BQU0sV0FBVyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDOUMsTUFBTSxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzNCLE1BQU0sb0JBQW9CLEdBQUcsR0FBRyxDQUFDLENBQUMsd0RBQXdEO1FBRTFGLHdCQUF3QjtRQUN4QixNQUFNLGNBQWMsR0FBRyxJQUFJLElBQUksQ0FBQyxJ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TztZQUNILE9BQU8sRUFBRSxJQUFJO1lBQ2IsT0FBTyxFQUFFLGVBQWUsSUFBSSx3QkFBd0I7WUFDcEQsSUFBSSxFQUFFO2dCQUNGLElBQUksRUFBRSxjQUFjLENBQUMsSUFBSSxJQUFJLGNBQWMsQ0FBQyxHQUFHO2dCQUMvQyxJQUFJLEVBQUUsY0FBYyxDQUFDLElBQUksSUFBSSxjQUFjLENBQUMsS0FBSztnQkFDakQsS0FBSyxFQUFFLEtBQUs7Z0JBQ1osTUFBTSxFQUFFLE1BQU07YUFDakI7U0FDSixDQUFDO0lBQ04sQ0FBQztJQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7UUFDbEIsT0FBTztZQUNILE9BQU8sRUFBRSxLQUFLO1lBQ2QsS0FBSyxFQUFFLEtBQUssQ0FBQyxPQUFPLElBQUksS0FBSztTQUNoQyxDQUFDO0lBQ04sQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNjcm9sbFZpZXcgVUkg5Yib5bu65aSE55CG5ZmoXG4gKiDlnKjlnLrmma/ohJrmnKzkuIrkuIvmlofkuK3miafooYzvvIzlj6/ku6Xnm7TmjqXorr/pl64gY2Mg5a+56LGhXG4gKi9cblxuLyoqXG4gKiDliJvlu7ogU2Nyb2xsVmlldyDnu4Tku7ZcbiAqIOe7k+aehDpcbiAqIC0gU2Nyb2xsVmlldyAoU3ByaXRlLCBTY3JvbGxWaWV3KVxuICogICAtIHNjcm9sbEJhciAoU3ByaXRlLCBTY3JvbGxiYXIsIFdpZGdldClcbiAqICAgICAtIGJhciAoU3ByaXRlKVxuICogICAtIHZpZXcgKE1hc2spXG4gKiAgICAgLSBjb250ZW50XG4gKiAgICAgICAtIGl0ZW0gKExhYmVsKVxuICogXG4gKiBAcGFyYW0gbmFtZSBTY3JvbGxWaWV3IOiKgueCueWQjeensFxuICogQHBhcmFtIHBhcmVudFV1aWQg54i26IqC54K5IFVVSURcbiAqIEBwYXJhbSB3aWR0aCDlrr3luqZcbiAqIEBwYXJhbSBoZWlnaHQg6auY5bqmXG4gKiBAcGFyYW0gc3ByaXRlRnJhbWVVdWlkIOiDjOaZryBTcHJpdGUgRnJhbWUgVVVJRFxuICogQHBhcmFtIGdldENDIOiOt+WPliBDb2NvcyDlvJXmk47lrp7kvovnmoTlh73mlbBcbiAqIEBwYXJhbSBtYXJrU2NlbmVEaXJ0eSDmoIforrDlnLrmma/kuLrohI/nmoTlh73mlbBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNjcm9sbFZpZXdXaXRoVGVtcGxhdGUoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHBhcmVudFV1aWQ6IHN0cmluZyB8IG51bGwsXG4gICAgd2lkdGg6IG51bWJlcixcbiAgICBoZWlnaHQ6IG51bWJlcixcbiAgICBzcHJpdGVGcmFtZVV1aWQ6IHN0cmluZyxcbiAgICBnZXRDQzogKCkgPT4gYW55LFxuICAgIG1hcmtTY2VuZURpcnR5OiAoKSA9PiB2b2lkXG4pIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBkaXJlY3RvcixcbiAgICAgICAgICAgIE5vZGUsXG4gICAgICAgICAgICBjb2xvclxuICAgICAgICB9ID0gZ2V0Q0MoKTtcbiAgICAgICAgY29uc3Qgc2NlbmUgPSBkaXJlY3Rvci5nZXRTY2VuZSgpO1xuICAgICAgICBpZiAoIXNjZW5lKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyBhY3RpdmUgc2NlbmUnIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBCQUNLR1JPVU5EX1NQUklURSA9IHNwcml0ZUZyYW1lVXVpZCB8fCAnOWJiZGEzMWUtYWQ0OS00M2M5LWFhZjItZjdkOTg5NmJhYzY5JztcbiAgICAgICAgY29uc3QgU0NST0xMQkFSX1NQUklURSA9ICc1ZmU1ZGNhYS1iNTEzLTRkYzUtYTE2Ni01NzM2MjdiM2ExNTknO1xuICAgICAgICBjb25zdCBTQ1JPTExCQVJfSEFORExFX1NQUklURSA9ICc1YzNiYjkzMi02YzNjLTQ2OGYtODhhOS1jOGM2MWQ0NTg2NDEnO1xuICAgICAgICBjb25zdCBJVEVNX1RFWFQgPSAnU2Nyb2xsVmlldyBjb250ZW50XFxuXFxuJztcbiAgICAgICAgY29uc3QgU0NST0xMQkFSX1dJRFRIID0gMTI7XG4gICAgICAgIGNvbnN0IEhBTkRMRV9TSVpFID0geyB3aWR0aDogMTAsIGhlaWdodDogMzAgfTtcbiAgICAgICAgY29uc3QgQ09OVEVOVF9QQURESU5HID0gMTA7XG4gICAgICAgIGNvbnN0IENPTlRFTlRfRVhUUkFfSEVJR0hUID0gMTUwOyAvLyAyNTAodmlldyBoZWlnaHQpIC0+IDQwMChjb250ZW50IGhlaWdodCkgaW4gaGVsbG93b3JsZFxuXG4gICAgICAgIC8vIDEuIOWIm+W7uuS4u+iKgueCuSAoU2Nyb2xsVmlldylcbiAgICAgICAgY29uc3Qgc2Nyb2xsVmlld05vZGUgPSBuZXcgTm9kZShuYW1lKTtcbiAgICAgICAgY29uc3QgcGFyZW50ID0gcGFyZW50VXVpZCA/IHNjZW5lLmdldENoaWxkQnlVdWlkKHBhcmVudFV1aWQpIDogc2NlbmU7XG4gICAgICAgIGlmIChwYXJlbnQpIHtcbiAgICAgICAgICAgIHBhcmVudC5hZGRDaGlsZChzY3JvbGxWaWV3Tm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzY2VuZS5hZGRDaGlsZChzY3JvbGxWaWV3Tm9kZSk7XG4gICAgICAgIH1cblxuICAgICAgICBzY3JvbGxWaWV3Tm9kZS5zZXRDb250ZW50U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgc2Nyb2xsVmlld05vZGUuc2V0QW5jaG9yUG9pbnQoMC41LCAwLjUpO1xuICAgICAgICBzY3JvbGxWaWV3Tm9kZS5hY3RpdmUgPSB0cnVlO1xuXG4gICAgICAgIC8vIOa3u+WKoOiDjOaZryBTcHJpdGVcbiAgICAgICAgY29uc3Qgc3ByaXRlQ29tcCA9IHNjcm9sbFZpZXdOb2RlLmFkZENvbXBvbmVudChjYy5TcHJpdGUpO1xuICAgICAgICBzcHJpdGVDb21wLnR5cGUgPSBjYy5TcHJpdGUuVHlwZS5TTElDRUQ7XG4gICAgICAgIHNwcml0ZUNvbXAuc2l6ZU1vZGUgPSBjYy5TcHJpdGUuU2l6ZU1vZGUuQ1VTVE9NO1xuICAgICAgICBjb25zdCBzcHJpdGVGcmFtZSA9IG5ldyBjYy5TcHJpdGVGcmFtZSgpO1xuICAgICAgICAoc3ByaXRlRnJhbWUgYXMgYW55KS5fdXVpZCA9IEJBQ0tHUk9VTkRfU1BSSVRFO1xuICAgICAgICBzcHJpdGVDb21wLnNwcml0ZUZyYW1lID0gc3ByaXRlRnJhbWU7XG5cbiAgICAgICAgLy8gMi4g5Yib5bu6IFNjcm9sbFZpZXcg57uE5Lu2XG4gICAgICAgIGNvbnN0IHNjcm9sbFZpZXdDb21wID0gc2Nyb2xsVmlld05vZGUuYWRkQ29tcG9uZW50KGNjLlNjcm9sbFZpZXcpO1xuICAgICAgICBzY3JvbGxWaWV3Q29tcC5ob3Jpem9udGFsID0gZmFsc2U7XG4gICAgICAgIHNjcm9sbFZpZXdDb21wLnZlcnRpY2FsID0gdHJ1ZTtcbiAgICAgICAgc2Nyb2xsVmlld0NvbXAuaW5lcnRpYSA9IHRydWU7XG4gICAgICAgIHNjcm9sbFZpZXdDb21wLmJyYWtlID0gMC43NTtcbiAgICAgICAgc2Nyb2xsVmlld0NvbXAuZWxhc3RpYyA9IHRydWU7XG4gICAgICAgIHNjcm9sbFZpZXdDb21wLmJvdW5jZUR1cmF0aW9uID0gMC4yMztcbiAgICAgICAgc2Nyb2xsVmlld0NvbXAuY2FuY2VsSW5uZXJFdmVudHMgPSB0cnVlO1xuXG4gICAgICAgIC8vIDMuIOWIm+W7uiB2aWV3IOiKgueCuSAoTWFzaylcbiAgICAgICAgY29uc3Qgdmlld05vZGUgPSBuZXcgTm9kZSgndmlldycpO1xuICAgICAgICBzY3JvbGxWaWV3Tm9kZS5hZGRDaGlsZCh2aWV3Tm9kZSk7XG4gICAgICAgIHZpZXdOb2RlLnNldENvbnRlbnRTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB2aWV3Tm9kZS5zZXRBbmNob3JQb2ludCgwLjUsIDAuNSk7XG4gICAgICAgIHZpZXdOb2RlLnNldFBvc2l0aW9uKDAsIDApO1xuXG4gICAgICAgIC8vIOa3u+WKoCBNYXNrIOe7hOS7tlxuICAgICAgICBjb25zdCBtYXNrQ29tcCA9IHZpZXdOb2RlLmFkZENvbXBvbmVudChjYy5NYXNrKTtcbiAgICAgICAgbWFza0NvbXAudHlwZSA9IGNjLk1hc2suVHlwZS5SRUNUO1xuXG4gICAgICAgIC8vIDQuIOWIm+W7uiBjb250ZW50IOiKgueCuVxuICAgICAgICBjb25zdCBjb250ZW50Tm9kZSA9IG5ldyBOb2RlKCdjb250ZW50Jyk7XG4gICAgICAgIHZpZXdOb2RlLmFkZENoaWxkKGNvbnRlbnROb2RlKTtcbiAgICAgICAgY29uc3QgY29udGVudFdpZHRoID0gTWF0aC5tYXgod2lkdGggLSBDT05URU5UX1BBRERJTkcgKiAyLCAwKTtcbiAgICAgICAgY29uc3QgY29udGVudEhlaWdodCA9IE1hdGgubWF4KGhlaWdodCArIENPTlRFTlRfRVhUUkFfSEVJR0hULCBoZWlnaHQpO1xuICAgICAgICBjb250ZW50Tm9kZS5zZXRDb250ZW50U2l6ZShjb250ZW50V2lkdGgsIGNvbnRlbnRIZWlnaHQpO1xuICAgICAgICBjb250ZW50Tm9kZS5zZXRBbmNob3JQb2ludCgwLjUsIDEpO1xuICAgICAgICBjb250ZW50Tm9kZS5zZXRQb3NpdGlvbigwLCBoZWlnaHQgLyAyIC0gQ09OVEVOVF9QQURESU5HKTtcblxuICAgICAgICAvLyA1LiDliJvlu7ogaXRlbSDoioLngrkgKyBMYWJlbFxuICAgICAgICBjb25zdCBpdGVtTm9kZSA9IG5ldyBOb2RlKCdpdGVtJyk7XG4gICAgICAgIGNvbnRlbnROb2RlLmFkZENoaWxkKGl0ZW1Ob2RlKTtcbiAgICAgICAgaXRlbU5vZGUuc2V0QW5jaG9yUG9pbnQoMCwgMSk7XG4gICAgICAgIGl0ZW1Ob2RlLnNldFBvc2l0aW9uKC1jb250ZW50V2lkdGggLyAyICsgQ09OVEVOVF9QQURESU5HIC0gMiwgLUNPTlRFTlRfUEFERElORyk7XG4gICAgICAgIGl0ZW1Ob2RlLmNvbG9yID0gY29sb3IoMCwgMCwgMCwgMjU1KTtcblxuICAgICAgICBjb25zdCBsYWJlbENvbXAgPSBpdGVtTm9kZS5hZGRDb21wb25lbnQoY2MuTGFiZWwpO1xuICAgICAgICBsYWJlbENvbXAuc3RyaW5nID0gSVRFTV9URVhUO1xuICAgICAgICBsYWJlbENvbXAuZm9udFNpemUgPSAxNjtcbiAgICAgICAgbGFiZWxDb21wLmxpbmVIZWlnaHQgPSAyMDtcbiAgICAgICAgbGFiZWxDb21wLmVuYWJsZVdyYXBUZXh0ID0gdHJ1ZTtcbiAgICAgICAgbGFiZWxDb21wLmhvcml6b250YWxBbGlnbiA9IGNjLkxhYmVsLkhvcml6b250YWxBbGlnbi5DRU5URVI7XG4gICAgICAgIGxhYmVsQ29tcC52ZXJ0aWNhbEFsaWduID0gY2MuTGFiZWwuVmVydGljYWxBbGlnbi5UT1A7XG5cbiAgICAgICAgLy8g6K6p6IqC54K55bC65a+46Lef6ZqP5paH5pys5YaF5a6577yM5ZKMIGhlbGxvd29ybGQg5Zy65pmv5LiA6Ie0XG4gICAgICAgIGlmICh0eXBlb2YgKGxhYmVsQ29tcCBhcyBhbnkpLl9mb3JjZVVwZGF0ZVJlbmRlckRhdGEgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIChsYWJlbENvbXAgYXMgYW55KS5fZm9yY2VVcGRhdGVSZW5kZXJEYXRhKHRydWUpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiAobGFiZWxDb21wIGFzIGFueSkuX3VwZGF0ZVJlbmRlckRhdGEgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIChsYWJlbENvbXAgYXMgYW55KS5fdXBkYXRlUmVuZGVyRGF0YSh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtZWFzdXJlZFNpemUgPSBpdGVtTm9kZS5nZXRDb250ZW50U2l6ZSgpO1xuICAgICAgICBpZiAobWVhc3VyZWRTaXplICYmIG1lYXN1cmVkU2l6ZS53aWR0aCA+IDAgJiYgbWVhc3VyZWRTaXplLmhlaWdodCA+IDApIHtcbiAgICAgICAgICAgIGl0ZW1Ob2RlLnNldENvbnRlbnRTaXplKG1lYXN1cmVkU2l6ZS53aWR0aCwgbWVhc3VyZWRTaXplLmhlaWdodCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtTm9kZS5zZXRDb250ZW50U2l6ZShjb250ZW50V2lkdGggKiAwLjYsIGxhYmVsQ29tcC5saW5lSGVpZ2h0ICogMyArIENPTlRFTlRfUEFERElORyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyA2LiDliJvlu7ogU2Nyb2xsQmFyIOWPiua7keWdl1xuICAgICAgICBjb25zdCBzY3JvbGxCYXJOb2RlID0gbmV3IE5vZGUoJ3Njcm9sbEJhcicpO1xuICAgICAgICBzY3JvbGxWaWV3Tm9kZS5hZGRDaGlsZChzY3JvbGxCYXJOb2RlKTtcbiAgICAgICAgc2Nyb2xsQmFyTm9kZS5zZXRDb250ZW50U2l6ZShTQ1JPTExCQVJfV0lEVEgsIGhlaWdodCk7XG4gICAgICAgIHNjcm9sbEJhck5vZGUuc2V0QW5jaG9yUG9pbnQoMSwgMC41KTtcbiAgICAgICAgc2Nyb2xsQmFyTm9kZS5zZXRQb3NpdGlvbih3aWR0aCAvIDIsIDApO1xuXG4gICAgICAgIC8vIFNjcm9sbEJhciDog4zmma9cbiAgICAgICAgY29uc3Qgc2Nyb2xsQmFyU3ByaXRlID0gc2Nyb2xsQmFyTm9kZS5hZGRDb21wb25lbnQoY2MuU3ByaXRlKTtcbiAgICAgICAgc2Nyb2xsQmFyU3ByaXRlLnR5cGUgPSBjYy5TcHJpdGUuVHlwZS5TTElDRUQ7XG4gICAgICAgIHNjcm9sbEJhclNwcml0ZS5zaXplTW9kZSA9IGNjLlNwcml0ZS5TaXplTW9kZS5DVVNUT007XG4gICAgICAgIGNvbnN0IHNjcm9sbEJhckZyYW1lID0gbmV3IGNjLlNwcml0ZUZyYW1lKCk7XG4gICAgICAgIChzY3JvbGxCYXJGcmFtZSBhcyBhbnkpLl91dWlkID0gU0NST0xMQkFSX1NQUklURTtcbiAgICAgICAgc2Nyb2xsQmFyU3ByaXRlLnNwcml0ZUZyYW1lID0gc2Nyb2xsQmFyRnJhbWU7XG5cbiAgICAgICAgLy8gU2Nyb2xsQmFyIOWvuem9kFxuICAgICAgICBjb25zdCBzY3JvbGxCYXJXaWRnZXQgPSBzY3JvbGxCYXJOb2RlLmFkZENvbXBvbmVudChjYy5XaWRnZXQpO1xuICAgICAgICBzY3JvbGxCYXJXaWRnZXQuaXNBbGlnblJpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgc2Nyb2xsQmFyV2lkZ2V0LmlzQWxpZ25Ub3AgPSB0cnVlO1xuICAgICAgICBzY3JvbGxCYXJXaWRnZXQuaXNBbGlnbkJvdHRvbSA9IHRydWU7XG4gICAgICAgIHNjcm9sbEJhcldpZGdldC5yaWdodCA9IDA7XG4gICAgICAgIHNjcm9sbEJhcldpZGdldC50b3AgPSAwO1xuICAgICAgICBzY3JvbGxCYXJXaWRnZXQuYm90dG9tID0gMDtcbiAgICAgICAgc2Nyb2xsQmFyV2lkZ2V0LnVwZGF0ZUFsaWdubWVudCgpO1xuICAgICAgICBzY3JvbGxCYXJOb2RlLnNldFNpYmxpbmdJbmRleCgwKTsgLy8g5LiOIGhlbGxvd29ybGQg5Zy65pmv55qE5a2Q6IqC54K56aG65bqP5L+d5oyB5LiA6Ie0XG5cbiAgICAgICAgLy8g5ruR5Z2XXG4gICAgICAgIGNvbnN0IGJhck5vZGUgPSBuZXcgTm9kZSgnYmFyJyk7XG4gICAgICAgIHNjcm9sbEJhck5vZGUuYWRkQ2hpbGQoYmFyTm9kZSk7XG4gICAgICAgIGJhck5vZGUuc2V0Q29udGVudFNpemUoSEFORExFX1NJWkUud2lkdGgsIEhBTkRMRV9TSVpFLmhlaWdodCk7XG4gICAgICAgIGJhck5vZGUuc2V0QW5jaG9yUG9pbnQoMSwgMCk7XG4gICAgICAgIGJhck5vZGUuc2V0UG9zaXRpb24oLTEsIDApO1xuXG4gICAgICAgIGNvbnN0IGJhclNwcml0ZSA9IGJhck5vZGUuYWRkQ29tcG9uZW50KGNjLlNwcml0ZSk7XG4gICAgICAgIGJhclNwcml0ZS50eXBlID0gY2MuU3ByaXRlLlR5cGUuU0xJQ0VEO1xuICAgICAgICBiYXJTcHJpdGUuc2l6ZU1vZGUgPSBjYy5TcHJpdGUuU2l6ZU1vZGUuQ1VTVE9NO1xuICAgICAgICBjb25zdCBiYXJTcHJpdGVGcmFtZSA9IG5ldyBjYy5TcHJpdGVGcmFtZSgpO1xuICAgICAgICAoYmFyU3ByaXRlRnJhbWUgYXMgYW55KS5fdXVpZCA9IFNDUk9MTEJBUl9IQU5ETEVfU1BSSVRFO1xuICAgICAgICBiYXJTcHJpdGUuc3ByaXRlRnJhbWUgPSBiYXJTcHJpdGVGcmFtZTtcblxuICAgICAgICAvLyBTY3JvbGxCYXIg57uE5Lu2XG4gICAgICAgIGNvbnN0IHNjcm9sbEJhckNvbXAgPSBzY3JvbGxCYXJOb2RlLmFkZENvbXBvbmVudChjYy5TY3JvbGxiYXIpO1xuICAgICAgICBzY3JvbGxCYXJDb21wLmhhbmRsZSA9IGJhclNwcml0ZTtcbiAgICAgICAgc2Nyb2xsQmFyQ29tcC5kaXJlY3Rpb24gPSBjYy5TY3JvbGxiYXIuRGlyZWN0aW9uLlZFUlRJQ0FMO1xuICAgICAgICBzY3JvbGxCYXJDb21wLmVuYWJsZUF1dG9IaWRlID0gdHJ1ZTtcbiAgICAgICAgc2Nyb2xsQmFyQ29tcC5hdXRvSGlkZVRpbWUgPSAxO1xuICAgICAgICBzY3JvbGxCYXJDb21wLnNjcm9sbFZpZXcgPSBzY3JvbGxWaWV3Q29tcDtcblxuICAgICAgICAvLyA3LiDlhbPogZQgU2Nyb2xsVmlldyDlhoXlrrnkuI7mu5rliqjmnaFcbiAgICAgICAgc2Nyb2xsVmlld0NvbXAuY29udGVudCA9IGNvbnRlbnROb2RlO1xuICAgICAgICBzY3JvbGxWaWV3Q29tcC52ZXJ0aWNhbFNjcm9sbEJhciA9IHNjcm9sbEJhckNvbXA7XG5cbiAgICAgICAgLy8g5qCH6K6w5Zy65pmv5Li65bey5L+u5pS55bm25L+d5a2YXG4gICAgICAgIG1hcmtTY2VuZURpcnR5KCk7XG4gICAgICAgIFxuICAgICAgICAvLyDpgJrnn6XnvJbovpHlmajliLfmlrDlnLrmma/op4blm75cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgRWRpdG9yICE9PSAndW5kZWZpbmVkJyAmJiBFZGl0b3IuSXBjICYmIEVkaXRvci5JcGMuc2VuZFRvUGFuZWwpIHtcbiAgICAgICAgICAgICAgICBFZGl0b3IuSXBjLnNlbmRUb1BhbmVsKCdzY2VuZScsICdzY2VuZTpzb2Z0LXJlbG9hZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdbc2NlbmUtc2NyaXB0XSBGYWlsZWQgdG8gcmVmcmVzaCBzY2VuZSB2aWV3OicsIGVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgbWVzc2FnZTogYFNjcm9sbFZpZXcgJyR7bmFtZX0nIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5YCxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB1dWlkOiBzY3JvbGxWaWV3Tm9kZS51dWlkIHx8IHNjcm9sbFZpZXdOb2RlLl9pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBzY3JvbGxWaWV3Tm9kZS5uYW1lIHx8IHNjcm9sbFZpZXdOb2RlLl9uYW1lLFxuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgZXJyb3JcbiAgICAgICAgfTtcbiAgICB9XG59XG4iXX0=