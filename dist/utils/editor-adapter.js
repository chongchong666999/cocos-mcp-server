"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ensureEditorAdapters = ensureEditorAdapters;
function ensureEditorAdapters() {
    const editor = Editor;
    if (!editor.Message) {
        editor.Message = {};
    }
    if (!editor.Ipc) {
        console.warn('[MCP插件] Editor.Ipc 不存在，部分功能可能无法工作');
        return;
    }
    if (!editor.Message.request) {
        editor.Message.request = function (channel, message, ...args) {
            if (channel === 'scene' && message === 'execute-scene-script') {
                const options = args[0] || {};
                const packageName = options.name || options.package;
                const methodName = options.method;
                const methodArgs = options.args || [];
                return new Promise((resolve, reject) => {
                    if (!Editor.Scene || !Editor.Scene.callSceneScript) {
                        reject(new Error('Editor.Scene.callSceneScript 不可用'));
                        return;
                    }
                    const callback = (err, result) => {
                        if (err) {
                            reject(err);
                        }
                        else {
                            resolve(result);
                        }
                    };
                    try {
                        Editor.Scene.callSceneScript(packageName, methodName, ...methodArgs, callback);
                    }
                    catch (error) {
                        reject(error);
                    }
                });
            }
            return new Promise((resolve, reject) => {
                const callback = (err, result) => {
                    if (err) {
                        reject(err);
                    }
                    else {
                        resolve(result);
                    }
                };
                try {
                    editor.Ipc.sendToMain(`${channel}:${message}`, ...args, callback);
                }
                catch (error) {
                    reject(error);
                }
            });
        };
    }
    if (!editor.Message.send) {
        editor.Message.send = function (channel, message, ...args) {
            try {
                editor.Ipc.sendToMain(`${channel}:${message}`, ...args);
            }
            catch (error) {
                console.error('[MCP插件] Message.send 调用失败:', error);
            }
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdG9yLWFkYXB0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvZWRpdG9yLWFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxvREFxRUM7QUFyRUQsU0FBZ0Isb0JBQW9CO0lBQ2hDLE1BQU0sTUFBTSxHQUFRLE1BQU0sQ0FBQztJQUUzQixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2xCLE1BQU0sQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ2QsT0FBTyxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1FBQ2xELE9BQU87SUFDWCxDQUFDO0lBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDMUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsVUFBVSxPQUFlLEVBQUUsT0FBZSxFQUFFLEdBQUcsSUFBVztZQUMvRSxJQUFJLE9BQU8sS0FBSyxPQUFPLElBQUksT0FBTyxLQUFLLHNCQUFzQixFQUFFLENBQUM7Z0JBQzVELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQzlCLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQztnQkFDcEQsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztnQkFDbEMsTUFBTSxVQUFVLEdBQVUsT0FBTyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUM7Z0JBRTdDLE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7b0JBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQzt3QkFDakQsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUMsQ0FBQzt3QkFDdEQsT0FBTztvQkFDWCxDQUFDO29CQUVELE1BQU0sUUFBUSxHQUFHLENBQUMsR0FBaUIsRUFBRSxNQUFXLEVBQUUsRUFBRTt3QkFDaEQsSUFBSSxHQUFHLEVBQUUsQ0FBQzs0QkFDTixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQ2hCLENBQUM7NkJBQU0sQ0FBQzs0QkFDSixPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7d0JBQ3BCLENBQUM7b0JBQ0wsQ0FBQyxDQUFDO29CQUVGLElBQUksQ0FBQzt3QkFDRCxNQUFNLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUUsVUFBVSxFQUFFLEdBQUcsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO29CQUNuRixDQUFDO29CQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7d0JBQ2IsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNsQixDQUFDO2dCQUNMLENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQztZQUVELE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7Z0JBQ25DLE1BQU0sUUFBUSxHQUFHLENBQUMsR0FBaUIsRUFBRSxNQUFXLEVBQUUsRUFBRTtvQkFDaEQsSUFBSSxHQUFHLEVBQUUsQ0FBQzt3QkFDTixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ2hCLENBQUM7eUJBQU0sQ0FBQzt3QkFDSixPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQ3BCLENBQUM7Z0JBQ0wsQ0FBQyxDQUFDO2dCQUVGLElBQUksQ0FBQztvQkFDRCxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLE9BQU8sSUFBSSxPQUFPLEVBQUUsRUFBRSxHQUFHLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztnQkFDdEUsQ0FBQztnQkFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO29CQUNiLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbEIsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDO0lBQ04sQ0FBQztJQUVELElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3ZCLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLFVBQVUsT0FBZSxFQUFFLE9BQWUsRUFBRSxHQUFHLElBQVc7WUFDNUUsSUFBSSxDQUFDO2dCQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsT0FBTyxJQUFJLE9BQU8sRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDNUQsQ0FBQztZQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7Z0JBQ2IsT0FBTyxDQUFDLEtBQUssQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN2RCxDQUFDO1FBQ0wsQ0FBQyxDQUFDO0lBQ04sQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gZW5zdXJlRWRpdG9yQWRhcHRlcnMoKSB7XG4gICAgY29uc3QgZWRpdG9yOiBhbnkgPSBFZGl0b3I7XG5cbiAgICBpZiAoIWVkaXRvci5NZXNzYWdlKSB7XG4gICAgICAgIGVkaXRvci5NZXNzYWdlID0ge307XG4gICAgfVxuXG4gICAgaWYgKCFlZGl0b3IuSXBjKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignW01DUOaPkuS7tl0gRWRpdG9yLklwYyDkuI3lrZjlnKjvvIzpg6jliIblip/og73lj6/og73ml6Dms5Xlt6XkvZwnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghZWRpdG9yLk1lc3NhZ2UucmVxdWVzdCkge1xuICAgICAgICBlZGl0b3IuTWVzc2FnZS5yZXF1ZXN0ID0gZnVuY3Rpb24gKGNoYW5uZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSk6IFByb21pc2U8YW55PiB7XG4gICAgICAgICAgICBpZiAoY2hhbm5lbCA9PT0gJ3NjZW5lJyAmJiBtZXNzYWdlID09PSAnZXhlY3V0ZS1zY2VuZS1zY3JpcHQnKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGFyZ3NbMF0gfHwge307XG4gICAgICAgICAgICAgICAgY29uc3QgcGFja2FnZU5hbWUgPSBvcHRpb25zLm5hbWUgfHwgb3B0aW9ucy5wYWNrYWdlO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGhvZE5hbWUgPSBvcHRpb25zLm1ldGhvZDtcbiAgICAgICAgICAgICAgICBjb25zdCBtZXRob2RBcmdzOiBhbnlbXSA9IG9wdGlvbnMuYXJncyB8fCBbXTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghRWRpdG9yLlNjZW5lIHx8ICFFZGl0b3IuU2NlbmUuY2FsbFNjZW5lU2NyaXB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdFZGl0b3IuU2NlbmUuY2FsbFNjZW5lU2NyaXB0IOS4jeWPr+eUqCcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrID0gKGVycjogRXJyb3IgfCBudWxsLCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEVkaXRvci5TY2VuZS5jYWxsU2NlbmVTY3JpcHQocGFja2FnZU5hbWUsIG1ldGhvZE5hbWUsIC4uLm1ldGhvZEFyZ3MsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjYWxsYmFjayA9IChlcnI6IEVycm9yIHwgbnVsbCwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLklwYy5zZW5kVG9NYWluKGAke2NoYW5uZWx9OiR7bWVzc2FnZX1gLCAuLi5hcmdzLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoIWVkaXRvci5NZXNzYWdlLnNlbmQpIHtcbiAgICAgICAgZWRpdG9yLk1lc3NhZ2Uuc2VuZCA9IGZ1bmN0aW9uIChjaGFubmVsOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogYW55W10pIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZWRpdG9yLklwYy5zZW5kVG9NYWluKGAke2NoYW5uZWx9OiR7bWVzc2FnZX1gLCAuLi5hcmdzKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW01DUOaPkuS7tl0gTWVzc2FnZS5zZW5kIOiwg+eUqOWksei0pTonLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxufVxuIl19